C51 COMPILER V9.52.0.0   KEY                                                               10/23/2020 17:04:10 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: H:\electric\Keil_v5\C51\BIN\C51.EXE key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\key.lst) TABS(2) OBJECT(.\Objects\key.obj)

line level    source

   1          /**
   2           * @file: key.c
   3           * @author: Honokawings (1915569481@qq.com)
   4           * @description: æ—‹è½¬ç¼–ç å™¨é©±åŠ¨æºä»£ç 
   5           * @version 0.1
   6           * @date: 2020-10-21 18:10:97
   7           * 
   8           * @copyright Copyright (c) 2020
   9           * 
  10           */
  11          
  12          #include "key.h"
  13          
  14          //jå±€å†…å®å˜é‡
  15          #define KEY_SCAN_MS         1                   //æ‰«æå‘¨æœŸ
  16          #define KEY_DESSHACKING     (20/KEY_SCAN_MS)    //æ¶ˆæŠ–å‘¨æœŸ
  17          #define KEY_LONGTIME        (600/KEY_SCAN_MS)   //é•¿æŒ‰åˆ¤å®š
  18          #define KEY_DCLICKTIME      (150/KEY_SCAN_MS)   //åŒå‡»åˆ¤å®š
  19          #define KEY_LONG_REPEAT     (200/KEY_SCAN_MS)   //è¿ç»­é•¿æŒ‰åˆ¤å®š
  20          
  21          //å±€å†…å˜é‡
  22          static char key_a_last=0;//aç›¸ä½ä¸Šä¸€æ¬¡çŠ¶æ€
  23          static char key_b_last=0;//bç›¸ä½ä¸Šä¸€æ¬¡çŠ¶æ€
  24          
  25          static u16 key_o_cnt=0;//æŒ‰é”®è®¡æ•°
  26          static u16 key_o_dclick_cnt=0; //åŒå‡»è®¡æ•°
  27          
  28          static char key_o_sclick_flag=0;//çŸ­æŒ‰æ ‡å¿—
  29          static char key_o_lclick_flag=0;//é•¿æŒ‰æ ‡å¿—
  30          static char key_o_dclick_flag=0;//åŒå‡»æ ‡å¿—
  31          
  32          /**
  33           * @description: ç¼–ç å™¨æŒ‰é”®åˆå§‹åŒ–
  34           * 
  35           */
  36          void key_init()
  37          {
  38   1          //è¾“å…¥å†™1
  39   1          key_a_now=1;
  40   1          key_b_now=1;
  41   1          key_o=1;
  42   1      
  43   1          //é¿å…è¯¯åˆ¤
  44   1          key_a_last=key_a_now;
  45   1          key_b_last=key_b_now;
  46   1      
  47   1          //æ¸…ç›¸å…³è®¡æ•°åŠæ ‡å¿—
  48   1          key_o_cnt=0;
  49   1          key_o_dclick_cnt=0;
  50   1          key_o_dclick_flag=0;
  51   1          key_o_lclick_flag=0;
  52   1          key_o_sclick_flag=0;
  53   1      }
  54          
C51 COMPILER V9.52.0.0   KEY                                                               10/23/2020 17:04:10 PAGE 2   

  55          /**
  56           * @description: æŒ‰é”®æ‰«æå‡½æ•°
  57           * 
  58           * @return: char 0-æ— åŠ¨ä½œ 
  59           *               1-ä»…æ­£è½¬ -1-ä»…åè½¬
  60           *               2-ä»…æŒ‰é”®
  61           *               3-æŒ‰é”®æ­£è½¬ -3-æŒ‰é”®åè½¬
  62           */
  63          char key_scan()
  64          {
  65   1          char scan_result=0;
  66   1      
  67   1          if (key_a_now!=key_a_last)//æ—‹è½¬åˆ¤å®š
  68   1          {
  69   2              if (key_a_now==0)//ä¸‹é™æ²¿
  70   2              {
  71   3                  if(key_b_now==1)
  72   3                      scan_result=1;//æ­£è½¬
  73   3                  else
  74   3                      scan_result=-1;//åè½¬
  75   3              }
  76   2              key_a_last=key_a_now;
  77   2              key_b_last=key_b_now;
  78   2          }
  79   1      
  80   1          if(key_o==0)
  81   1          {
  82   2              if(scan_result==0)
  83   2                  scan_result=2;
  84   2              else
  85   2              {
  86   3                  if(scan_result==1)
  87   3                      scan_result=3;
  88   3                  if(scan_result==-1)
  89   3                      scan_result=-3;
  90   3              }
  91   2          } 
  92   1          return scan_result;
  93   1      }
  94          
  95          /**
  96           * @description: æŒ‰é”®æƒ…å†µåˆ†æç¨‹åº
  97           * 
  98           * @param: scan_result_analyze æŒ‰é”®æ‰«æç»“æœ
  99           * @return: char 0-é™æ€
 100           *               1-å•å‡» 2-åŒå‡» 3-é•¿æŒ‰ 4-è¿ç»­é•¿æŒ‰
 101           *               5-æ­£è½¬ -5-åè½¬
 102           *               6-æŒ‰é”®æ­£è½¬ -6-æŒ‰é”®åè½¬
 103           */
 104          char key_analyze(char scan_result_analyze)
 105          {
 106   1          char analyze_result=0;
 107   1          static unsigned int TMP_Value = 0;//è¿ç»­é•¿æŒ‰é—´éš”
 108   1      
 109   1          //æ—‹è½¬å¤„ç†å‡½æ•°
 110   1          if(scan_result_analyze==1)
 111   1              analyze_result=5;
 112   1          if(scan_result_analyze==-1)
 113   1              analyze_result=-5;
 114   1      
 115   1          //æŒ‰ä¸‹æ—‹è½¬å¤„ç†å‡½æ•°
 116   1          if(scan_result_analyze==3)
C51 COMPILER V9.52.0.0   KEY                                                               10/23/2020 17:04:10 PAGE 3   

 117   1              analyze_result=6;
 118   1          if(scan_result_analyze==-3)
 119   1              analyze_result=-6;
 120   1      
 121   1          //æŒ‰é”®çŠ¶æ€å¤„ç†ç¨‹åº
 122   1          if(scan_result_analyze==2)//æ‰«æåˆ°æŒ‰ä¸‹æŒ‰é”®
 123   1          {
 124   2              if(key_o_cnt<10000)//æ‰“å¼€è®¡æ•°å®šæ—¶å™¨
 125   2                  key_o_cnt++; 
 126   2      
 127   2              if(key_o_cnt>=KEY_DESSHACKING)//çŸ­æŒ‰åˆ¤å®š
 128   2              {
 129   3                  key_o_sclick_flag=1;
 130   3                             
 131   3                  if(key_o_cnt==KEY_LONGTIME)//é•¿æŒ‰åˆ¤å®š
 132   3                  {
 133   4                      key_o_sclick_flag=0;
 134   4                      key_o_lclick_flag=1;
 135   4                  }
 136   3              }
 137   2      
 138   2              //è‹¥å·²ç»åˆ¤å®šåœ¨åŒå‡»é—´éš”ä¸­ï¼Œå†æŒ‰ä¸‹æŒ‰é”®ï¼Œåˆ™åˆ¤å®šè¿›å…¥åŒå‡»(çŠ¶æ€1)
 139   2              if((key_o_dclick_cnt>0)&&(key_o_dclick_cnt<=KEY_DCLICKTIME))
 140   2                  key_o_dclick_flag=1;
 141   2          }
 142   1          else if(scan_result_analyze==0)//æ¾å¼€æŒ‰é”®
 143   1          {
 144   2              if(key_o_cnt<KEY_DESSHACKING)   //æœªåˆ°æ¶ˆæŠ–æ—¶é•¿å³æ¾å¼€æŒ‰é”®ï¼Œæ¸…é™¤æ‰€æœ‰æ ‡å¿—
 145   2              {                               
 146   3                  key_o_cnt=0;
 147   3                  key_o_dclick_cnt=0;
 148   3                  key_o_dclick_flag=0;
 149   3                  key_o_lclick_flag=0;
 150   3                  key_o_sclick_flag=0;
 151   3              }
 152   2              else
 153   2              {
 154   3                  if(key_o_sclick_flag==1)//çŸ­æŒ‰çŠ¶æ€ä¿æŒä¸­
 155   3                  {
 156   4                      //åŒå‡»åˆ¤å®šè®¡æ—¶
 157   4                      if((key_o_dclick_flag==0)&&(key_o_dclick_cnt>=0))
 158   4                          key_o_dclick_cnt++;
 159   4      
 160   4                      //åŒå‡»åˆ¤å®šåœ¨åŒå‡»é™å®šæ—¶é—´ï¼ˆKEY_DCLICKTIMEï¼‰å†…äºŒæ¬¡é‡Šæ”¾(æ»¡è¶³çŠ¶æ€1)åˆ™å
             -Œå‡»æˆåŠŸ(çŠ¶æ€2)
 161   4                      if((key_o_dclick_flag==1)&&(key_o_dclick_cnt<=KEY_DCLICKTIME))
 162   4                          key_o_dclick_flag=2;
 163   4      
 164   4                      //åŒå‡»åˆ¤å®šåœ¨åŒå‡»é™å®šæ—¶é—´ï¼ˆKEY_DCLICKTIMEï¼‰å†…æ²¡å†æ¬¡æŒ‰ä¸‹åˆ™åˆ¤å®šåŒå‡»å¤
             -±è´¥(ä¿æŒçŠ¶æ€0)
 165   4                      if((key_o_dclick_flag==0)&&(key_o_dclick_cnt>KEY_DCLICKTIME))
 166   4                          key_o_sclick_flag=0;//çŸ­æŒ‰é‡Šæ”¾
 167   4                  }
 168   3                  if(key_o_lclick_flag==1)//é•¿æŒ‰é‡Šæ”¾
 169   3                      key_o_lclick_flag=0;
 170   3              }
 171   2          }
 172   1      
 173   1          //æŒ‰é”®é«˜çº§å¤„ç†ç¨‹åº
 174   1          if(key_o_cnt>KEY_DESSHACKING)//çŸ­æŒ‰å¯åŠ¨å
 175   1          {
 176   2              //å•å‡»æœªåŒå‡»æœªé•¿æŒ‰
C51 COMPILER V9.52.0.0   KEY                                                               10/23/2020 17:04:10 PAGE 4   

 177   2              if((key_o_sclick_flag==0)&&(key_o_dclick_cnt>KEY_DCLICKTIME)&&(key_o_lclick_flag<KEY_LONGTIME))
 178   2              {
 179   3                  analyze_result=1;
 180   3                  //æ¸…é™¤æ ‡å¿—
 181   3                  key_o_cnt=0;
 182   3                  key_o_dclick_cnt=0;
 183   3                  key_o_dclick_flag=0;
 184   3              }
 185   2              //åŒå‡»
 186   2              if((key_o_dclick_flag==2)&&(key_o_dclick_cnt>0)&&(key_o_dclick_cnt<=KEY_DCLICKTIME))
 187   2              {
 188   3                  analyze_result=2;
 189   3                  //æ¸…é™¤æ ‡å¿—
 190   3                  key_o_dclick_cnt=0;
 191   3                  key_o_cnt=0;
 192   3                  key_o_sclick_flag=0;
 193   3                  key_o_dclick_flag=0;
 194   3              }
 195   2              //é•¿æŒ‰
 196   2              if((key_o_lclick_flag==0)&&(key_o_cnt>=KEY_LONGTIME))
 197   2              {
 198   3                  analyze_result=3;
 199   3                  //æ¸…é™¤æ ‡å¿—
 200   3                  key_o_cnt=0;
 201   3                  key_o_dclick_cnt=0;
 202   3              }
 203   2              //è¿ç»­é•¿æŒ‰
 204   2              if((key_o_lclick_flag==1)&&(key_o_cnt>=KEY_LONGTIME))
 205   2              {
 206   3                  TMP_Value++;
 207   3                  if(TMP_Value%KEY_LONG_REPEAT==0)
 208   3                  {
 209   4                      TMP_Value=0;
 210   4                      analyze_result=4;
 211   4                  }
 212   3              }
 213   2          }
 214   1          return analyze_result;
 215   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    466    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
